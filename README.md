# 简单编译器设计实现

## 项目概述
本项目实现一个支持简化版C语言（小C语言）的编译器，包含词法分析、语法分析、语义分析与中间代码生成等核心模块。可选实现代码优化和目标代码生成。

## 设计语言
小C语言（简化版C语言）文法如下：

### 词法规则
1. 关键字：`main`, `int`, `if`, `else`, `while`, `for`
2. 标识符：字母开头，后跟字母或数字
3. 常量：无符号整数
4. 运算符：`+`, `-`, `*`, `/`, `=`, `>`, `<`, `>=`, `<=`, `==`, `!=`
5. 分隔符：`(`, `)`, `{`, `}`, `;`, `,`

### 语法规则（上下文无关文法）
```
<程序> → <main关键字>(){<声明序列><语句序列>}
<声明序列> → <声明序列><声明语句> | <声明语句> | <空>
<声明语句> → <int关键字><标识符表>;
<标识符表> → <标识符>,<标识符表> | <标识符>
<语句序列> → <语句序列><语句> | <语句>
<语句> → <if语句> | <while语句> | <for语句> | <复合语句> | <赋值语句>
<if语句> → <if关键字> (<表达式>)<复合语句>; | <if关键字> (<表达式>)<复合语句><else关键字><复合语句>;
<while语句> → <while关键字> (<表达式>)<复合语句>;
<for语句> → <for关键字> (<表达式>;<表达式>;<表达式>) <复合语句>;
<复合语句> → {<语句序列>}
<赋值语句> → <表达式>;
<表达式> → <标识符>=<算数表达式> | <布尔表达式>
<布尔表达式> → <算数表达式> | <算数表达式><关系运算符><算数表达式>
<关系运算符> → > | < | >= | <= | == | !=
<算数表达式> → <算数表达式>+<项> | <算数表达式>-<项> | <项>
<项> → <项>*<因子> | <项>/<因子> | <因子>
<因子> → <标识符> | <无符号整数> | (<算数表达式>)
<标识符> → <字母> | <标识符><字母> | <标识符><数字>
<无符号整数> → <数字> | <无符号整数><数字>
<字母> → a|b|...|z|A|B|...|Z
<数字> → 0|1|2|3|4|5|6|7|8|9
<main关键字> → main
<if关键字> → if
<else关键字> → else
<while关键字> → while
<for关键字> → for
<int关键字> → int
```

## 项目结构
```
simple-compiler/
├── README.md                    # 项目说明
├── language_spec.md             # 详细语言规范
├── lexer.py                     # 词法分析器
├── parser.py                    # 语法分析器（递归下降）
├── semantic.py                  # 语义分析与中间代码生成
├── optimizer.py                 # 代码优化模块（可选）
├── codegen.py                   # 目标代码生成模块（可选）
├── code_fixer.py                # 代码错误检测与修复模块（新增）
├── main.py                      # 主程序入口
├── run_compiler.bat             # Windows启动脚本
├── run_compiler.sh              # Linux/macOS启动脚本
├── test.c                       # 测试用例
├── test_with_errors.c           # 错误代码测试用例
├── test_error_*.c               # 各类错误测试文件
└── output/                      # 输出目录
```

## 核心功能模块
1. **代码错误检测与修复模块**（新增）：自动检测并修复常见源代码错误
2. **词法分析模块**：扫描源程序，识别单词符号，生成二元组序列
3. **语法分析模块**：采用递归下降分析法，检查语法结构，构建语法树
4. **语义分析与中间代码生成模块**：进行类型检查、作用域检查，生成四元式
5. **代码优化模块**（可选）：常量折叠、公共子表达式消除等
6. **目标代码生成模块**（可选）：生成x86汇编代码

## 开发环境
- 编程语言：Python 3.x
- 开发工具：Visual Studio Code
- 操作系统：Windows/Linux/macOS

## 新增功能：代码错误检测与修复

### 功能特点
1. **自动错误检测**：在编译前自动检测源代码中的常见错误
2. **智能修复**：尝试修复检测到的错误，提高代码可编译性
3. **完整报告**：生成详细的错误修复报告
4. **普适性**：能够处理各种C语言文件，不局限于特定测试用例

### 支持的错误类型
1. **关键字拼写错误**：`maim` → `main`, `itn` → `int`, `iff` → `if`, `els` → `else`, `whiel` → `while`, `fo` → `for`
2. **变量声明错误**：缺失类型说明符、缺失逗号、缺失分号
3. **语句结束错误**：赋值语句缺失分号、表达式语句缺失分号
4. **括号错误**：缺失右括号
5. **for循环错误**：缺失分号分隔符
6. **大括号错误**：缺失大括号的复合语句

### 输出文件
当代码有错误时，编译器会生成：
- `fixed_code.c` - 修复好的代码
- `code_fix_report.txt` - 错误报告
- `assembly.asm` - 根据修复代码生成的汇编代码
- 其他所有中间输出文件（tokens.txt, ast.txt, symbol_table.txt, quadruples.txt等）

## 使用说明
1. 安装Python 3.x
2. 运行编译器：
   - 命令行模式：`python main.py test.c`
   - 交互模式：`python main.py`
   - 使用启动脚本：`run_compiler.bat` (Windows) 或 `run_compiler.sh` (Linux/macOS)
3. 查看输出结果在output/目录中

### 启动脚本功能
启动脚本提供以下选项：
1. **交互模式**：推荐使用，提供图形化操作界面
2. **编译测试文件**：编译预定义的测试用例
3. **测试错误代码修复**：专门测试代码修复功能，包含6种不同类型的错误测试
4. **退出**

### 错误测试文件
- `test_with_errors.c` - 多种错误类型混合
- `test_error_missing_semicolon.c` - 缺失分号
- `test_error_typo_keywords.c` - 关键字拼写错误
- `test_error_missing_parentheses.c` - 缺失括号
- `test_error_missing_braces.c` - 缺失大括号
- `test_error_complex.c` - 复杂多重错误

## 测试用例
包含正确和错误的源程序，验证各模块功能。

## 作者
计科2306 贺元

## 许可证
MIT License
