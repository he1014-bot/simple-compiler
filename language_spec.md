# 小C语言规范文档

## 1. 语言概述
小C语言是C语言的一个简化子集，用于教学和编译器设计实践。它支持基本的变量声明、赋值、控制结构（if、while、for）和算术运算。

## 2. 词法规则（正规式）

### 2.1 单词符号分类
| 类别 | 正规式 | 示例 | 种别码 |
|------|--------|------|--------|
| 关键字 | `main` \| `int` \| `if` \| `else` \| `while` \| `for` | `main`, `int` | 1-6 |
| 标识符 | `[a-zA-Z][a-zA-Z0-9]*` | `a`, `sum`, `count1` | 10 |
| 无符号整数 | `[0-9]+` | `123`, `0`, `42` | 11 |
| 运算符 | `+` \| `-` \| `*` \| `/` \| `=` \| `>` \| `<` \| `>=` \| `<=` \| `==` \| `!=` | `+`, `==` | 21-31 |
| 分隔符 | `(` \| `)` \| `{` \| `}` \| `;` \| `,` | `(`, `;` | 41-46 |
| 注释 | `//[^\n]*` 或 `/\*.*?\*/` | `// comment` | 跳过 |
| 空白字符 | `[ \t\n\r]+` | 空格、制表符、换行 | 跳过 |

### 2.2 种别码编码表
| 单词符号 | 种别码 | 属性值 |
|----------|--------|--------|
| `main` | 1 | - |
| `int` | 2 | - |
| `if` | 3 | - |
| `else` | 4 | - |
| `while` | 5 | - |
| `for` | 6 | - |
| 标识符 | 10 | 符号表指针 |
| 无符号整数 | 11 | 数值 |
| `+` | 21 | - |
| `-` | 22 | - |
| `*` | 23 | - |
| `/` | 24 | - |
| `=` | 25 | - |
| `>` | 26 | - |
| `<` | 27 | - |
| `>=` | 28 | - |
| `<=` | 29 | - |
| `==` | 30 | - |
| `!=` | 31 | - |
| `(` | 41 | - |
| `)` | 42 | - |
| `{` | 43 | - |
| `}` | 44 | - |
| `;` | 45 | - |
| `,` | 46 | - |

## 3. 语法规则（上下文无关文法）

### 3.1 文法定义（已改写为LL(1)文法）
```
Program → main ( ) { DeclList StmtList }
DeclList → Decl DeclList | ε
Decl → int IdList ;
IdList → id , IdList | id
StmtList → Stmt StmtList | ε
Stmt → IfStmt | WhileStmt | ForStmt | CompoundStmt | AssignStmt
IfStmt → if ( Expr ) CompoundStmt ; | if ( Expr ) CompoundStmt else CompoundStmt ;
WhileStmt → while ( Expr ) CompoundStmt ;
ForStmt → for ( Expr ; Expr ; Expr ) CompoundStmt ;
CompoundStmt → { StmtList }
AssignStmt → Expr ;
Expr → id = ArithExpr | BoolExpr
BoolExpr → ArithExpr RelOp ArithExpr | ArithExpr
RelOp → > | < | >= | <= | == | !=
ArithExpr → Term ArithExpr'
ArithExpr' → + Term ArithExpr' | - Term ArithExpr' | ε
Term → Factor Term'
Term' → * Factor Term' | / Factor Term' | ε
Factor → id | num | ( ArithExpr )
```

### 3.2 消除左递归后的表达式文法（用于递归下降）
```
E → T E'
E' → + T E' | - T E' | ε
T → F T'
T' → * F T' | / F T' | ε
F → id | num | ( E )
```

赋值表达式单独处理：
```
AssignExpr → id = E
```

## 4. 语义规则

### 4.1 类型系统
- 只有一种类型：`int`（整型）
- 所有变量必须先声明后使用
- 表达式结果类型为`int`

### 4.2 作用域规则
- 单一作用域（全局）
- 不支持嵌套作用域

### 4.3 语义检查
1. **变量未声明检查**：使用标识符前必须已声明
2. **类型匹配检查**：运算符两边的操作数必须为整型
3. **控制结构条件检查**：if、while、for的条件表达式必须为布尔类型
4. **赋值左值检查**：赋值语句左边必须是标识符

## 5. 中间代码表示
采用四元式形式：(op, arg1, arg2, result)

### 5.1 四元式操作符
| 操作符 | 含义 | 示例 |
|--------|------|------|
| `=` | 赋值 | `(=, a, _, x)` 表示 `x = a` |
| `+` | 加法 | `(+, a, b, t1)` 表示 `t1 = a + b` |
| `-` | 减法 | `(-, a, b, t1)` |
| `*` | 乘法 | `(*, a, b, t1)` |
| `/` | 除法 | `(/, a, b, t1)` |
| `j>` | 大于跳转 | `(j>, a, b, L1)` |
| `j<` | 小于跳转 | `(j<, a, b, L1)` |
| `j>=` | 大于等于跳转 | `(j>=, a, b, L1)` |
| `j<=` | 小于等于跳转 | `(j<=, a, b, L1)` |
| `j==` | 等于跳转 | `(j==, a, b, L1)` |
| `j!=` | 不等于跳转 | `(j!=, a, b, L1)` |
| `jump` | 无条件跳转 | `(jump, _, _, L1)` |
| `label` | 标号定义 | `(label, _, _, L1)` |

## 6. 目标代码（可选）
目标平台：x86-64汇编
- 使用寄存器分配简单策略
- 栈帧管理
- 基本指令：mov, add, sub, imul, idiv, cmp, jmp, je, jne等

## 7. 错误处理
### 7.1 词法错误
- 非法字符
- 未结束的注释
- 数字格式错误

### 7.2 语法错误
- 缺少分号
- 括号不匹配
- 关键字拼写错误
- 表达式语法错误

### 7.3 语义错误
- 变量未声明
- 类型不匹配
- 重复声明

## 8. 示例程序
### 8.1 正确示例
```c
main(){
    int a, b;
    a = 1;
    b = a + 2;
    if (a > b) {
        a = b;
    } else {
        b = a;
    }
    while (a < 10) {
        a = a + 1;
    }
}
```

### 8.2 错误示例（用于测试）
```c
main(){
    int a;
    b = 1;  // 错误：b未声明
    a = 1.5; // 错误：类型不匹配（实型常量不支持）
    if (a) { // 错误：条件表达式应为布尔类型
        a = 2;
    }
}
```

## 9. 参考文献
- 《编译原理》（龙书）
- 《现代编译原理》（虎书）
- LL(1)文法转换方法
